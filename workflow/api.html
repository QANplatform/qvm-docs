<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Common API</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../workflow/index.html"><strong aria-hidden="true">2.</strong> Generic workflow</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../workflow/api.html" class="active"><strong aria-hidden="true">2.1.</strong> Common API</a></li><li class="chapter-item expanded "><a href="../workflow/write.html"><strong aria-hidden="true">2.2.</strong> Writing a contract</a></li><li class="chapter-item expanded "><a href="../workflow/compile.html"><strong aria-hidden="true">2.3.</strong> Compiling a contract</a></li><li class="chapter-item expanded "><a href="../workflow/qvmctl.html"><strong aria-hidden="true">2.4.</strong> Installing qvmctl</a></li><li class="chapter-item expanded "><a href="../workflow/deploy.html"><strong aria-hidden="true">2.5.</strong> Deploying a contract</a></li><li class="chapter-item expanded "><a href="../workflow/call.html"><strong aria-hidden="true">2.6.</strong> Calling a contract function</a></li><li class="chapter-item expanded "><a href="../workflow/read.html"><strong aria-hidden="true">2.7.</strong> Reading contract storage</a></li></ol></li><li class="chapter-item expanded "><a href="../languages/index.html"><strong aria-hidden="true">3.</strong> Supported languages</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../languages/go/index.html"><strong aria-hidden="true">3.1.</strong> Go</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../languages/go/write.html"><strong aria-hidden="true">3.1.1.</strong> Writing a contract</a></li><li class="chapter-item expanded "><a href="../languages/go/compile.html"><strong aria-hidden="true">3.1.2.</strong> Compiling a contract</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../versions/index.html"><strong aria-hidden="true">4.</strong> Versions & Changelog</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../versions/v0.0.1.html"><strong aria-hidden="true">4.1.</strong> V0.0.1</a></li><li class="chapter-item expanded "><a href="../versions/v0.0.2.html"><strong aria-hidden="true">4.2.</strong> V0.0.2</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="generic-api"><a class="header" href="#generic-api">Generic API</a></h1>
<p>Any contract can interact with QVM by following the generic API described below:</p>
<h2 id="reading-from-the-database"><a class="header" href="#reading-from-the-database">Reading from the database</a></h2>
<p>QVM calls specify database slots to be accessed during contract execution.
These slots are made available under their specified keys in the execution context via environment variables.</p>
<p>Let's say the decimal precision and total supply information of a token is required for read and/or write in a contract interaction, then executing the following call would make it available under the environment variables DB_TOTAL_SUPPLY and DB_DECIMALS:</p>
<pre><code>qvmctl call 0xCAFEBABE -r TOTAL_SUPPLY,DECIMALS print info
</code></pre>
<p>Then this contract would receive two command line arguments &quot;print&quot; and &quot;info&quot; and could print token information related to total supply and decimals which properties are available as environment variables as stated above.</p>
<h2 id="writing-to-the-database"><a class="header" href="#writing-to-the-database">Writing to the database</a></h2>
<p>If a contract wants to write to the database to insert and/or modify a record under a certain key, it needs to write the following instruction to the process' STDOUT:</p>
<pre><code>DBW=$KEY=$VALUE
</code></pre>
<p>For example if a token's name is updatable and is stored under the key <code>TOKEN_NAME</code>, it could be updated easily to something else like this in Golang:</p>
<pre><code class="language-go">os.Stdout.WriteString(&quot;DBW=TOKEN_NAME=NewTokenName\n&quot;)
</code></pre>
<h2 id="deleting-pruning-values-from-the-database"><a class="header" href="#deleting-pruning-values-from-the-database">Deleting (pruning) values from the database</a></h2>
<p>To prune key(s) from the database, simply output a &quot;DBP=&quot; prefixed new-line (\n) terminated line to stdout:</p>
<pre><code>DBP=removekey
</code></pre>
<p>Above line would delete the storage slot under key &quot;removekey&quot; from persistent storage.
Multiple keys can be removed either by specifying more lines prefixed with &quot;DBP=&quot;, or simply concatenating keys to be removed with ',' like this:</p>
<pre><code>DBP=removekey,removethistoo
</code></pre>
<p>Above line would delete the storage slot under key &quot;removekey&quot; and also &quot;removethistoo&quot; from persistent storage.</p>
<h2 id="writing-to-virtual-stdout"><a class="header" href="#writing-to-virtual-stdout">Writing to virtual STDOUT</a></h2>
<p>Since the &quot;real&quot; STDOUT is reserved for the specific opcodes above, writing to a &quot;virtual&quot; STDOUT is achieved as simply outputting a &quot;OUT=&quot; prefixed new-line (\n) terminated line to stdout:</p>
<pre><code>OUT=Program ran all good
</code></pre>
<p>The string &quot;Program ran all good&quot; will be emitted on-chain as event data, but not persisted to the database. This is a lot cheaper in gas fees than writing to storage, but this data is only visible to clients and not usable in a next contract interaction as it is not saved to state.</p>
<h2 id="reporting-errors"><a class="header" href="#reporting-errors">Reporting errors</a></h2>
<p>If a contract execution fails for any reason, developers can utilize normal behavior and simply write the error to STDERR.
This will mark the contract call as failed due to STDERR not being empty, and emit STDERR content (trimmed to the first 32 bytes).</p>
<p>Note that this will cause all previous instructions written to STDOUT to be discarded and call state will be set as failed, and only the bytes written to STDERR will be emitted as an on-chain event similar to how STDOUT works above.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../workflow/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../workflow/write.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../workflow/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../workflow/write.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
